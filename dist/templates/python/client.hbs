"""
Generated API Client
This file was auto-generated by GIDEVO API Tool
Do not edit manually
"""

import requests
from typing import Optional, Dict, Any, List, TypeVar, Generic
from dataclasses import dataclass
from enum import Enum
from .models import *

T = TypeVar('T')


class HttpMethod(Enum):
    GET = "GET"
    POST = "POST"
    PUT = "PUT"
    PATCH = "PATCH"
    DELETE = "DELETE"


@dataclass
class ApiResponse(Generic[T]):
    """Generic API response wrapper"""
    data: T
    status_code: int
    headers: Dict[str, str]


@dataclass
class ErrorResponse:
    """Error response from API"""
    message: str
    code: str
    details: Optional[Dict[str, Any]] = None


class ApiError(Exception):
    """API Error exception"""
    def __init__(self, message: str, status_code: int, response: Optional[Dict] = None):
        self.message = message
        self.status_code = status_code
        self.response = response
        super().__init__(self.message)


class ApiClient:
    """
    API Client for {{info.title}}
    Version: {{info.version}}
    {{#if info.description}}
    Description: {{info.description}}
    {{/if}}
    """

    def __init__(
        self,
        base_url: str,
        token: Optional[str] = None,
        timeout: int = 30,
        headers: Optional[Dict[str, str]] = None
    ):
        """
        Initialize the API client.
        
        Args:
            base_url: The base URL for the API
            token: Optional bearer token for authentication
            timeout: Request timeout in seconds (default: 30)
            headers: Additional headers to include in requests
        """
        self.base_url = base_url.rstrip('/')
        self.timeout = timeout
        self.session = requests.Session()
        self.session.headers['Content-Type'] = 'application/json'
        
        if token:
            self.session.headers['Authorization'] = f'Bearer {token}'
        
        if headers:
            self.session.headers.update(headers)

    def set_token(self, token: str) -> None:
        """Set the authorization token."""
        self.session.headers['Authorization'] = f'Bearer {token}'

    def clear_token(self) -> None:
        """Remove the authorization token."""
        if 'Authorization' in self.session.headers:
            del self.session.headers['Authorization']

    def _request(
        self,
        method: HttpMethod,
        path: str,
        data: Optional[Dict[str, Any]] = None,
        params: Optional[Dict[str, Any]] = None,
        headers: Optional[Dict[str, str]] = None
    ) -> Dict[str, Any]:
        """
        Make an HTTP request.
        
        Args:
            method: HTTP method
            path: API endpoint path
            data: Request body data
            params: Query parameters
            headers: Additional headers
            
        Returns:
            Response data as dictionary
            
        Raises:
            ApiError: If the request fails
        """
        url = f'{self.base_url}{path}'
        
        request_headers = dict(self.session.headers)
        if headers:
            request_headers.update(headers)
        
        try:
            response = self.session.request(
                method=method.value,
                url=url,
                json=data,
                params=params,
                headers=request_headers,
                timeout=self.timeout
            )
            response.raise_for_status()
            
            if response.content:
                return response.json()
            return {}
            
        except requests.exceptions.HTTPError as e:
            error_data = {}
            try:
                error_data = e.response.json()
            except:
                pass
            raise ApiError(
                message=error_data.get('message', str(e)),
                status_code=e.response.status_code,
                response=error_data
            )
        except requests.exceptions.RequestException as e:
            raise ApiError(message=str(e), status_code=0)

    def get(self, path: str, params: Optional[Dict[str, Any]] = None) -> Dict[str, Any]:
        """Make a GET request."""
        return self._request(HttpMethod.GET, path, params=params)

    def post(self, path: str, data: Optional[Dict[str, Any]] = None) -> Dict[str, Any]:
        """Make a POST request."""
        return self._request(HttpMethod.POST, path, data=data)

    def put(self, path: str, data: Optional[Dict[str, Any]] = None) -> Dict[str, Any]:
        """Make a PUT request."""
        return self._request(HttpMethod.PUT, path, data=data)

    def patch(self, path: str, data: Optional[Dict[str, Any]] = None) -> Dict[str, Any]:
        """Make a PATCH request."""
        return self._request(HttpMethod.PATCH, path, data=data)

    def delete(self, path: str) -> Dict[str, Any]:
        """Make a DELETE request."""
        return self._request(HttpMethod.DELETE, path)

    # ============================================
    # Generated API Methods
    # ============================================

{{#each paths}}
{{#each this}}
    def {{methodName @key @../key}}(self{{#if (eq @key 'post')}}, data: Optional[Dict[str, Any]] = None{{else if (eq @key 'put')}}, data: Optional[Dict[str, Any]] = None{{else if (eq @key 'patch')}}, data: Optional[Dict[str, Any]] = None{{/if}}) -> Dict[str, Any]:
        """
        {{summary}}
        {{#if description}}
        {{description}}
        {{/if}}
        
        Path: {{@../key}}
        Method: {{@key}}
        """
        {{#if (eq @key 'get')}}
        return self.get('{{@../key}}')
        {{else if (eq @key 'post')}}
        return self.post('{{@../key}}', data)
        {{else if (eq @key 'put')}}
        return self.put('{{@../key}}', data)
        {{else if (eq @key 'patch')}}
        return self.patch('{{@../key}}', data)
        {{else if (eq @key 'delete')}}
        return self.delete('{{@../key}}')
        {{/if}}

{{/each}}
{{/each}}

# For convenience, also export the client
__all__ = ['ApiClient', 'ApiError', 'ApiResponse', 'ErrorResponse']
